import os
import sys

# --- Make sure project root is on sys.path ---
CURRENT_DIR = os.path.dirname(os.path.abspath(__file__))
PROJECT_ROOT = os.path.dirname(CURRENT_DIR)
if PROJECT_ROOT not in sys.path:
    sys.path.insert(0, PROJECT_ROOT)

from env.dvwa_sqli_env import DVWASQLiEnv


def main():
    env = DVWASQLiEnv(base_url="http://127.0.0.1:4280", max_steps=10)

    obs, info = env.reset()
    print("Initial obs:", obs)

    done = False
    truncated = False
    step = 0

    while not (done or truncated):
        action = env.action_space.sample()
        obs, reward, done, truncated, info = env.step(action)

        print(
            f"Step {step}: action={action}, reward={reward:.2f}, "
            f"success={info['success']}, error={info['error']}, "
            f"resp_len={info['resp_len']}"
        )

        step += 1

    env.close()


if __name__ == "__main__":
    main()
